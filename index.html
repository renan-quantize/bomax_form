<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sele√ß√£o de Temas - BOMAX</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Arial,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
.container{background:white;border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,0.3);max-width:700px;width:100%;padding:40px}
.header{text-align:center;margin-bottom:30px;padding-bottom:20px;border-bottom:2px solid #f1f5f9}
.logo{font-size:48px;margin-bottom:10px}
h1{color:#1e293b;font-size:28px;margin-bottom:8px}
.subtitle{color:#64748b;font-size:16px}
.info-box{background:#f8fafc;border-left:4px solid #3b82f6;padding:16px;border-radius:8px;margin-bottom:24px}
.info-box strong{color:#1e293b;display:block;margin-bottom:8px}
.info-box ul{list-style:none;color:#475569;font-size:14px;line-height:1.8}
.info-box li:before{content:"‚Ä¢";color:#3b82f6;font-weight:bold;display:inline-block;width:1em;margin-left:-1em}
.tema-card{border:2px solid #e2e8f0;border-radius:12px;padding:20px;margin-bottom:16px;transition:all .2s ease;cursor:pointer}
.tema-card:hover{border-color:#3b82f6;box-shadow:0 4px 12px rgba(59,130,246,0.1)}
.tema-card.selected{border-color:#3b82f6;background:#eff6ff}
.tema-checkbox{display:flex;align-items:start;gap:12px}
.tema-checkbox input[type="checkbox"]{width:20px;height:20px;margin-top:2px;cursor:pointer;flex-shrink:0}
.tema-content{flex:1}
.tema-titulo{font-weight:600;color:#1e293b;font-size:16px;margin-bottom:8px;line-height:1.4}
.tema-descricao{color:#64748b;font-size:14px;line-height:1.6;margin-bottom:12px}
.keywords{display:flex;flex-wrap:wrap;gap:6px}
.keyword-tag{background:#dbeafe;color:#1e40af;padding:4px 10px;border-radius:6px;font-size:12px;font-weight:500}
.counter{background:#3b82f6;color:white;padding:16px;border-radius:8px;text-align:center;font-weight:600;font-size:16px;margin:24px 0;transition:background .3s ease}
.counter.success{background:#10b981}
.counter.error{background:#ef4444}
.btn-submit{width:100%;background:#10b981;color:white;border:none;padding:16px;border-radius:8px;font-size:16px;font-weight:600;cursor:pointer;transition:all .2s ease}
.btn-submit:hover:not(:disabled){background:#059669;transform:translateY(-1px);box-shadow:0 4px 12px rgba(16,185,129,0.3)}
.btn-submit:disabled{background:#94a3b8;cursor:not-allowed;transform:none}
.footer{margin-top:24px;padding-top:20px;border-top:1px solid #e2e8f0;text-align:center;color:#94a3b8;font-size:13px}
.loading{display:none;text-align:center;padding:40px}
.spinner{border:4px solid #f3f4f6;border-top:4px solid #3b82f6;border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite;margin:0 auto 16px}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.success-message,.error-message,.expired-message{display:none;text-align:center;padding:40px}
.success-icon,.error-icon,.expired-icon{font-size:64px;margin-bottom:16px}
@media (max-width:640px){.container{padding:24px}h1{font-size:24px}.tema-card{padding:16px}}
</style>
</head>
<body>

<div class="container">
  <!-- LOADING INICIAL -->
  <div class="loading" id="loadingState" style="display:block">
    <div class="spinner"></div>
    <p style="color:#64748b">Validando acesso...</p>
  </div>

  <!-- FORMUL√ÅRIO -->
  <div id="formState" style="display:none">
    <div class="header">
      <div class="logo">üìù</div>
      <h1>Selecione os Temas do Blog</h1>
      <p class="subtitle">BOMAX ‚Ä¢ janeiro de 2026</p>
    </div>

    <div class="info-box">
      <strong>üìå Como funciona:</strong>
      <ul>
        <li>Selecione <strong>exatamente 4 temas</strong> que mais se alinham com sua estrat√©gia</li>
        <li>Esses temas ser√£o desenvolvidos nos pr√≥ximos 2 meses</li>
        <li>Voc√™ tem at√© <strong>25/01/2026</strong> para responder</li>
      </ul>
    </div>

    <form id="formTemas">
      <div id="temasContainer">
        
        <div class="tema-card" onclick="toggleCard(0)">
          <div class="tema-checkbox">
            <input type="checkbox" id="tema_0" name="temas_selecionados" value="61" 
              onclick="event.stopPropagation()" onchange="updateCounter()">
            <div class="tema-content">
              <div class="tema-titulo">Bomba Centr√≠fuga com Vaz√£o Inst√°vel? 3 Causas e Corre√ß√µes Pr√°ticas</div>
              <div class="tema-descricao">Identifique desgaste de p√°s, cavita√ß√£o e desbalanceamento antes que causem paradas n√£o programadas em linhas de produ√ß√£o</div>
              <div class="keywords">
                <span class="keyword-tag">bomba centr√≠fuga</span><span class="keyword-tag">cavita√ß√£o</span><span class="keyword-tag">paradas n√£o programadas</span>
              </div>
            </div>
          </div>
        </div>
        
        <div class="tema-card" onclick="toggleCard(1)">
          <div class="tema-checkbox">
            <input type="checkbox" id="tema_1" name="temas_selecionados" value="62" 
              onclick="event.stopPropagation()" onchange="updateCounter()">
            <div class="tema-content">
              <div class="tema-titulo">Dimensionamento de Filtro Prensa: C√°lculo de √Årea Filtrante Baseado em Vaz√£o e S√≥lidos</div>
              <div class="tema-descricao">Calcule a √°rea necess√°ria considerando concentra√ß√£o de part√≠culas, press√£o de opera√ß√£o e tempo de ciclo para evitar sobredimensionamento</div>
              <div class="keywords">
                <span class="keyword-tag">filtro prensa</span><span class="keyword-tag">dimensionamento</span><span class="keyword-tag">concentra√ß√£o de s√≥lidos</span>
              </div>
            </div>
          </div>
        </div>
        
        <div class="tema-card" onclick="toggleCard(2)">
          <div class="tema-checkbox">
            <input type="checkbox" id="tema_2" name="temas_selecionados" value="63" 
              onclick="event.stopPropagation()" onchange="updateCounter()">
            <div class="tema-content">
              <div class="tema-titulo">5 Crit√©rios T√©cnicos para Especificar Bomba Dosadora em Processos Farmac√™uticos</div>
              <div class="tema-descricao">Compare precis√£o de dosagem, material de contato e certifica√ß√£o GMP para garantir conformidade regulat√≥ria</div>
              <div class="keywords">
                <span class="keyword-tag">bomba dosadora</span><span class="keyword-tag">GMP</span><span class="keyword-tag">farmac√™utico</span>
              </div>
            </div>
          </div>
        </div>
        
        <div class="tema-card" onclick="toggleCard(3)">
          <div class="tema-checkbox">
            <input type="checkbox" id="tema_3" name="temas_selecionados" value="64" 
              onclick="event.stopPropagation()" onchange="updateCounter()">
            <div class="tema-content">
              <div class="tema-titulo">Bomba Pneum√°tica vs. Pneum√°tica de Diafragma: Qual Atende Melhor Processos Cont√≠nuos?</div>
              <div class="tema-descricao">Compare efici√™ncia energ√©tica, vida √∫til de componentes e capacidade de manuseio de produtos viscosos</div>
              <div class="keywords">
                <span class="keyword-tag">bomba pneum√°tica</span><span class="keyword-tag">diafragma</span><span class="keyword-tag">processos cont√≠nuos</span>
              </div>
            </div>
          </div>
        </div>
        
        <div class="tema-card" onclick="toggleCard(4)">
          <div class="tema-checkbox">
            <input type="checkbox" id="tema_4" name="temas_selecionados" value="65" 
              onclick="event.stopPropagation()" onchange="updateCounter()">
            <div class="tema-content">
              <div class="tema-titulo">Como Amortecedor de Pulsa√ß√£o Reduz 30% de Desgaste em Bombas Centr√≠fugas</div>
              <div class="tema-descricao">Evite vibra√ß√µes excessivas com dimensionamento correto de di√¢metro e press√£o de trabalho em sistemas de alta frequ√™ncia</div>
              <div class="keywords">
                <span class="keyword-tag">amortecedor de pulsa√ß√£o</span><span class="keyword-tag">vibra√ß√£o</span><span class="keyword-tag">bomba centr√≠fuga</span>
              </div>
            </div>
          </div>
        </div>
        
        <div class="tema-card" onclick="toggleCard(5)">
          <div class="tema-checkbox">
            <input type="checkbox" id="tema_5" name="temas_selecionados" value="66" 
              onclick="event.stopPropagation()" onchange="updateCounter()">
            <div class="tema-content">
              <div class="tema-titulo">Como F√°brica de Cosm√©ticos Resolveu Problemas de Homogeneiza√ß√£o com Misturador de Eixo M√∫ltiplo</div>
              <div class="tema-descricao">Case de implementa√ß√£o com redu√ß√£o de 18% no tempo de mistura e aumento de 25% na estabilidade do produto final</div>
              <div class="keywords">
                <span class="keyword-tag">misturador industrial</span><span class="keyword-tag">homogeneiza√ß√£o</span><span class="keyword-tag">cosm√©ticos</span>
              </div>
            </div>
          </div>
        </div>
        
      </div>

      <div class="counter" id="contador">0 de 4 temas selecionados</div>

      <button type="submit" id="btnSubmit" class="btn-submit" disabled>
        ‚úì Confirmar Temas Selecionados
      </button>
    </form>

    <div class="footer">
      Este formul√°rio foi gerado automaticamente pelo sistema de Blog da Quantize
    </div>
  </div>

  <!-- J√Å RESPONDIDO -->
  <div class="success-message" id="successState">
    <div class="success-icon">‚úÖ</div>
    <h2 style="color:#10b981;margin-bottom:12px">Temas Confirmados!</h2>
    <p style="color:#64748b">Seus temas foram registrados com sucesso. Em breve come√ßaremos a produ√ß√£o do conte√∫do!</p>
  </div>

  <!-- ERRO -->
  <div class="error-message" id="errorState">
    <div class="error-icon">‚ùå</div>
    <h2 style="color:#ef4444;margin-bottom:12px">Acesso Negado</h2>
    <p style="color:#64748b" id="errorMessage">Link inv√°lido ou expirado. Entre em contato conosco.</p>
  </div>

  <!-- EXPIRADO -->
  <div class="expired-message" id="expiredState">
    <div class="expired-icon">‚è∞</div>
    <h2 style="color:#f59e0b;margin-bottom:12px">Prazo Expirado</h2>
    <p style="color:#64748b">O prazo para sele√ß√£o de temas expirou. Nossa equipe escolher√° os temas automaticamente.</p>
  </div>
</div>

<script>
const CONFIG={
  approvalId:'4917215_1768935216100',
  token:'f4eecc69344d66e2a8de57bf78890a8a',
  projectId:'4917215',
  nomeEmpresa:'BOMAX',
  webhookUrl:'https://n8n-webhook.srv.superix.dev/webhook/dc624383-20d1-44ab-904e-a7572b30d46e'
};

let selectedCount=0;

// üîê VALIDA√á√ÉO INICIAL SIMPLIFICADA
document.addEventListener('DOMContentLoaded',async()=>{
  const urlParams=new URLSearchParams(window.location.search);
  const urlToken=urlParams.get('token');
  const urlApproval=urlParams.get('approval');
  
  // Validar token da URL
  if(!urlToken||urlToken!==CONFIG.token||urlApproval!==CONFIG.approvalId){
    showState('error');
    document.getElementById('errorMessage').textContent='Link inv√°lido. Verifique o email e use o link correto.';
    return;
  }
  
  // Token v√°lido, mostra formul√°rio
  showState('form');
});

function toggleCard(idx){
  const cb=document.getElementById('tema_'+idx);
  cb.checked=!cb.checked;
  updateCounter();
}

function updateCounter(){
  const cbs=document.querySelectorAll('input[name="temas_selecionados"]:checked');
  selectedCount=cbs.length;
  
  const contador=document.getElementById('contador');
  const btn=document.getElementById('btnSubmit');
  
  contador.textContent=selectedCount+' de 4 temas selecionados';
  contador.className='counter';
  
  if(selectedCount===4){
    contador.classList.add('success');
    btn.disabled=false;
  }else if(selectedCount>4){
    contador.classList.add('error');
    btn.disabled=true;
  }else{
    btn.disabled=true;
  }
  
  document.querySelectorAll('.tema-card').forEach((card,i)=>{
    const cb=document.getElementById('tema_'+i);
    card.classList.toggle('selected',cb.checked);
  });
}

document.getElementById('formTemas').addEventListener('submit',async function(e){
  e.preventDefault();
  
  if(selectedCount!==4){
    alert('Por favor, selecione exatamente 4 temas!');
    return;
  }
  
  showState('loading');
  document.querySelector('#loadingState p').textContent='Salvando sua sele√ß√£o...';
  
  const cbs=document.querySelectorAll('input[name="temas_selecionados"]:checked');
  const temasIds=Array.from(cbs).map(cb=>cb.value);
  
  const payload={
    token:CONFIG.token,
    approval_id:CONFIG.approvalId,
    project_id:CONFIG.projectId,
    nome_empresa:CONFIG.nomeEmpresa,
    temas_selecionados:temasIds
  };
  
  try{
    const resp=await fetch(CONFIG.webhookUrl,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify(payload)
    });
    
    const data=await resp.json();
    
    if(resp.ok){
      showState('success');
      document.querySelector('#successState h2').textContent='Temas Confirmados!';
      document.querySelector('#successState p').textContent='Seus temas foram registrados com sucesso. Em breve come√ßaremos a produ√ß√£o do conte√∫do.';
    }else{
      // Tratamento de erros espec√≠ficos
      if(data.status===409){
        showState('success');
        document.querySelector('#successState h2').textContent='Formul√°rio J√° Respondido';
        document.querySelector('#successState p').textContent='Voc√™ j√° selecionou seus temas anteriormente. Aguarde a produ√ß√£o do conte√∫do!';
      }else if(data.status===410){
        showState('expired');
      }else{
        throw new Error(data.message||'Erro ao enviar');
      }
    }
  }catch(err){
    console.error('Erro:',err);
    document.getElementById('errorMessage').textContent=err.message||'N√£o foi poss√≠vel enviar. Tente novamente.';
    showState('error');
  }
});

function showState(state){
  const states=['loading','form','success','error','expired'];
  states.forEach(s=>{
    const el=document.getElementById(s+'State');
    if(el)el.style.display=s===state?'block':'none';
  });
}
</script>
</body>
</html>